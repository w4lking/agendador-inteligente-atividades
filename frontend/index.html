<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agendador Inteligente de Atividades ao Ar Livre</title>
    <!-- Aqui é Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Open Sans', sans-serif;
            background: linear-gradient(to right top, #4a0e9d, #00bcd4); /* Gradiente de fundo mais ousado */
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 2rem;
            overflow: hidden; /* Evita scroll desnecessário */
        }
        .container {
            max-width: 900px;
            background-color: rgba(255, 255, 255, 0.98); /* Fundo quase opaco para o card */
            border-radius: 2.5rem; /* Bordas super arredondadas */
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3); /* Sombra bem profunda */
            backdrop-filter: blur(15px); /* Efeito de desfoque mais intenso */
            border: 2px solid rgba(255, 255, 255, 0.5); /* Borda mais visível */
            transform: scale(0.95); /* Levemente menor para dar destaque ao fundo */
            animation: fadeInScale 0.8s ease-out forwards; /* Animação de entrada */
        }

        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        h1 {
            font-family: 'Montserrat', sans-serif;
            color: #2c3e50; /* Cor escura para o título */
            font-weight: 800; /* Extra negrito */
            text-shadow: 2px 2px 4px rgba(0,0,0,0.15); /* Sombra de texto mais forte */
            margin-bottom: 2.5rem; /* Mais espaço abaixo do título */
        }
        label {
            font-family: 'Montserrat', sans-serif;
            color: #34495e; /* Cor para os labels */
            font-weight: 700; /* Negrito para labels */
            font-size: 1.1rem; /* Fonte um pouco maior */
        }
        .input-field {
            border: 3px solid #b3e0f2; /* Borda mais grossa e suave */
            background-color: #f0f8ff; /* Fundo azul claro para inputs */
            transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94); /* Transição mais complexa */
            border-radius: 1rem; /* Bordas bem arredondadas para inputs */
            padding: 0.85rem 1.25rem; /* Mais padding */
            font-size: 1.05rem; /* Fonte um pouco maior */
        }
        .input-field:focus {
            border-color: #4a0e9d; /* Cor de foco do gradiente */
            box-shadow: 0 0 0 5px rgba(74, 14, 157, 0.4); /* Sombra de foco bem intensa */
            background-color: #ffffff; /* Fundo branco no foco */
        }
        .btn-primary {
            background: linear-gradient(to right, #4a0e9d, #00bcd4); /* Gradiente para o botão */
            transition: all 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94); /* Transição mais complexa */
            border-radius: 1.5rem; /* Bordas super arredondadas para o botão */
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3); /* Sombra para o botão */
            letter-spacing: 0.08em; /* Mais espaçamento entre letras */
            font-size: 1.3rem; /* Fonte maior */
            padding: 0.9rem 1.8rem; /* Mais padding */
            text-transform: uppercase; /* Texto em maiúsculas */
            font-weight: 700; /* Negrito */
        }
        .btn-primary:hover {
            background: linear-gradient(to left, #4a0e9d, #00bcd4); /* Inverte o gradiente no hover */
            transform: translateY(-5px) scale(1.05); /* Efeito de levantamento e aumento mais pronunciado */
            box-shadow: 0 15px 25px rgba(0, 0, 0, 0.4); /* Sombra mais intensa no hover */
        }
        .message-box {
            background-color: rgba(255, 255, 255, 0.95);
            border-left: 6px solid #4a0e9d; /* Cor de borda padrão do gradiente */
            border-radius: 1rem;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15); /* Sombra mais visível */
            padding: 1.8rem;
            font-size: 1.05rem;
        }
        .message-box.error {
            border-left-color: #e74c3c; /* Vermelho mais forte */
        }
        .message-box.loading {
            border-left-color: #f39c12; /* Laranja mais forte */
        }
        .message-box h3 {
            color: #340a6e; /* Cor para títulos de mensagem */
            font-family: 'Montserrat', sans-serif;
            font-weight: 800;
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }
        .message-box p {
            color: #333;
            line-height: 1.6;
        }
        .message-box ul li {
            color: #444;
            margin-bottom: 0.4rem;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
    <div class="container p-8 space-y-8">
        <h1 class="text-4xl text-center">
            Agendador Inteligente de Atividades ao Ar Livre
        </h1>

        <div class="space-y-6">
            <div>
                <label for="city" class="block mb-2">Cidade:</label>
                <input type="text" id="city" value="Lavras"
                       class="input-field w-full focus:outline-none focus:ring-4"
                       placeholder="Ex: Lavras, São Paulo">
            </div>
            <div>
                <label for="date" class="block mb-2">Data (AAAA-MM-DD):</label>
                <input type="date" id="date"
                       class="input-field w-full focus:outline-none focus:ring-4">
            </div>
            <div>
                <label for="preferredActivity" class="block mb-2">Atividade Preferida (Opcional):</label>
                <input type="text" id="preferredActivity"
                       class="input-field w-full focus:outline-none focus:ring-4"
                       placeholder="Ex: caminhada, corrida, ciclismo">
            </div>
            <button id="scheduleBtn"
                    class="btn-primary w-full text-white py-3 px-6">
                Agendar Atividade
            </button>
        </div>

        <!-- Área dos Resultados -->
        <div id="results" class="mt-10 space-y-4">
            <!-- Colocar Mensagens de erro/sucesso/loading tudo aqui dps -->
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const scheduleBtn = document.getElementById("scheduleBtn");
            const cityInput = document.getElementById("city");
            const dateInput = document.getElementById("date");
            const preferredActivityInput = document.getElementById("preferredActivity");
            const resultsDiv = document.getElementById("results");

            // Define a data padrão para o dia de amanhã
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            dateInput.value = tomorrow.toISOString().split("T")[0]; // Formato YYYY-MM-DD

            const API_URL = "http://localhost:3000/schedule-activity"; // URL da sua API Principal

            scheduleBtn.addEventListener("click", async () => {
                const city = cityInput.value.trim();
                const date = dateInput.value; // Já está no formato YYYY-MM-DD
                const preferredActivity = preferredActivityInput.value.trim();

                if (!city || !date) {
                    displayMessage("Por favor, preencha a cidade e a data.", "error");
                    return;
                }

                resultsDiv.innerHTML = "";
                displayMessage("Buscando as melhores opções...", "loading");
                scheduleBtn.disabled = true;

                try {
                    const response = await fetch(API_URL, {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({ city, date, preferredActivity: preferredActivity || undefined }),
                    });

                    const data = await response.json();

                    if (!response.ok) {
                        displayMessage(`Erro: ${data.message || "Ocorreu um erro na requisição."}`, "error");
                        if (data.details) {
                            resultsDiv.innerHTML += `<div class="message-box mt-4 p-4 text-sm text-red-700 bg-red-50 rounded-lg">Detalhes: ${data.details}</div>`;
                        }
                        return;
                    }

                    // Exibir os resultados de sucesso
                    let resultHtml = `
                        <div class="message-box p-4 shadow-md">
                            <h3 class="text-xl font-semibold mb-2">Resumo da Recomendação</h3>
                            <p class="text-gray-700"><strong>Cidade:</strong> ${data.requested.city}</p>
                            <p class="text-gray-700"><strong>Data Solicitada:</strong> ${data.requested.date}</p>
                    `;

                    // Condições de Climas
                    resultHtml += `
                            <h4 class="text-lg font-semibold mt-4 mb-2 text-indigo-700">Recomendação Climática</h4>
                            <p class="text-gray-700">${data.weatherRecommendation.message}</p>
                    `;

                    if (data.weatherRecommendation.optimalTime) {
                        resultHtml += `
                            <p class="text-gray-700"><strong>Melhor Horário Sugerido:</strong> ${data.weatherRecommendation.optimalTime}</p>
                            <p class="text-gray-700"><strong>Temperatura Esperada:</strong> ${data.weatherRecommendation.temperature}°C</p>
                            <p class="text-gray-700"><strong>Condição do Tempo:</strong> ${data.weatherRecommendation.weatherDescription}</p>
                        `;
                    }

                    if (data.weatherRecommendation.otherOptimalHoursToday && data.weatherRecommendation.otherOptimalHoursToday.length > 0) {
                        resultHtml += `<h5 class="text-md font-semibold mt-3 text-indigo-600">Outros Horários Ótimos no Dia:</h5><ul class="list-disc list-inside text-gray-700">`;
                        data.weatherRecommendation.otherOptimalHoursToday.forEach(hour => {
                            resultHtml += `<li>${hour.time} (${hour.temperature}°C, ${hour.description})</li>`;
                        });
                        resultHtml += `</ul>`;
                    }

                    if (data.weatherRecommendation.recommendedFutureDates && data.weatherRecommendation.recommendedFutureDates.length > 0) {
                        resultHtml += `<h5 class="text-md font-semibold mt-3 text-indigo-600">Opções em Datas Futuras:</h5><ul class="list-disc list-inside text-gray-700">`;
                        data.weatherRecommendation.recommendedFutureDates.forEach(futureDate => {
                            resultHtml += `<li>${futureDate.date} às ${futureDate.bestHour.time} (${futureDate.bestHour.temperature}°C, ${futureDate.bestHour.description})</li>`;
                        });
                        resultHtml += `</ul>`;
                    }


                    // Recomendações de Atividades da IA
                    resultHtml += `
                            <h4 class="text-lg font-semibold mt-4 mb-2 text-indigo-700">Recomendação de Atividades (IA)</h4>
                            <ul class="list-disc list-inside text-gray-700 space-y-1">
                    `;
                    if (data.activityRecommendation.activities && data.activityRecommendation.activities.length > 0) {
                        data.activityRecommendation.activities.forEach(item => {
                            if (typeof item === "string") {
                                resultHtml += `<li>${item}</li>`;
                            } else {
                                resultHtml += `<li><strong>${item.activity}</strong>: ${item.justification}</li>`;
                            }
                        });
                    } else if (data.activityRecommendation.message) {
                        resultHtml += `<li>${data.activityRecommendation.message}</li>`;
                    } else {
                        resultHtml += `<li>Nenhuma atividade específica recomendada.</li>`;
                    }
                    resultHtml += `</ul>`;

                    if (data.activityRecommendation.justification && typeof data.activityRecommendation.justification === "string") {
                         resultHtml += `<p class="text-gray-700 mt-2"><strong>Justificativa Geral:</strong> ${data.activityRecommendation.justification}</p>`;
                    }


                    resultHtml += `</div>`;
                    resultsDiv.innerHTML = resultHtml;

                } catch (error) {
                    console.error("Erro ao conectar com a API:", error);
                    displayMessage("Não foi possível conectar ao serviço de agendamento. Verifique se o backend está rodando.", "error");
                } finally {
                    scheduleBtn.disabled = false;
                }
            });

            function displayMessage(message, type = "info") {
                resultsDiv.innerHTML = `<div class="message-box p-4 text-blue-700 rounded-lg ${type}">
                    ${message}
                </div>`;
                if (type === "error") {
                    resultsDiv.querySelector(".message-box").classList.add("bg-red-50", "border-red-500");
                    resultsDiv.querySelector(".message-box").classList.remove("text-blue-700", "bg-blue-50", "border-blue-500", "text-yellow-700", "bg-yellow-50", "border-yellow-500");
                } else if (type === "loading") {
                    resultsDiv.querySelector(".message-box").classList.add("bg-yellow-50", "border-yellow-500", "text-yellow-700");
                    resultsDiv.querySelector(".message-box").classList.remove("text-blue-700", "bg-blue-50", "border-blue-500", "text-red-700", "bg-red-50", "border-red-500");
                } else { // info
                    resultsDiv.querySelector(".message-box").classList.add("bg-blue-50", "border-blue-500");
                    resultsDiv.querySelector(".message-box").classList.remove("text-red-700", "bg-red-50", "border-red-500", "text-yellow-700", "bg-yellow-50", "border-yellow-500");
                }
            }
        });
    </script>
</body>
</html>


